<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ATEC 인사관리(근태) 프로그램 · v6</title>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
<style>
  body{font-family:'Pretendard','Noto Sans KR',sans-serif;background:#f6f8fb;margin:0;color:#111827}
  header{background:#fff;padding:14px 20px;font-weight:800;border-bottom:1px solid #e5e7eb}
  .topbar{position:sticky;top:0;z-index:20;background:rgba(255,255,255,.95);border-bottom:1px solid #e5e7eb;backdrop-filter:blur(6px)}
  .stepper{display:flex;align-items:center;gap:12px;max-width:1100px;margin:auto;padding:10px 16px}
  .step{display:flex;align-items:center;gap:10px;padding:8px 12px;border:1px solid #ddd;border-radius:14px;background:#fff;cursor:pointer;font-weight:700}
  .step.active{border-color:#2563eb;box-shadow:0 3px 14px rgba(37,99,235,.1)}
  .step .num{background:#f3f4f6;border-radius:50%;width:26px;height:26px;display:grid;place-items:center}
  .step.active .num{background:#2563eb;color:#fff}
  .chev{flex:1;height:2px;background:linear-gradient(90deg,#e5e7eb 0%,#c7d2fe 50%,#e5e7eb 100%)}
  main{max-width:1100px;margin:20px auto;padding:0 16px}
  .card{background:#fff;border:1px solid #e5e7eb;border-radius:18px;box-shadow:0 6px 24px rgba(0,0,0,.05);padding:20px;margin:18px 0}
  .page{display:none;opacity:0;transition:opacity .3s ease,transform .3s ease}
  .page.show{display:block;opacity:1}
  .kpi{border:1px solid #e5e7eb;border-radius:16px;padding:14px;text-align:center}
  .kpi h3{margin:0;font-size:15px;color:#6b7280}
  .kpi .big{font-size:26px;font-weight:800;margin-top:4px}
  .kpi .small{font-size:13px;color:#374151;line-height:1.6;margin-top:6px}
  .summary-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
  .chart-row{display:flex;justify-content:center;align-items:flex-start;flex-wrap:wrap;gap:24px}
  .chart-box{width:360px;max-width:45vw;text-align:center}
  .chart-box canvas{max-height:260px}
  .chart-box p{font-size:15px;font-weight:600;margin:.6rem 0 0}
  .sum-meta{line-height:1.7;margin-top:6px}
  canvas{width:100%!important;height:auto!important}
  .toast{position:fixed;bottom:20px;right:20px;background:#111;color:#fff;padding:10px 14px;border-radius:10px;display:none}
</style>
</head>
<body>
<header>ATEC 인사관리(근태) 프로그램</header>

<div class="topbar">
  <div class="stepper">
    <div class="step active" data-step="1"><div class="num">1</div>업로드</div>
    <div class="chev"></div>
    <div class="step" data-step="2"><div class="num">2</div>리포트</div>
    <div class="chev"></div>
    <div class="step" data-step="3"><div class="num">3</div>세부내역</div>
    <div class="chev"></div>
    <div class="step" data-step="4"><div class="num">4</div>데이터 저장</div>
  </div>
</div>

<main>
<section id="page2" class="page show">
  <div class="card" style="text-align:center;">
    <h2>총 수당(시간외+휴일) 5,007,959원</h2>
    <p class="sum-meta">당월: 5,007,959원 (전월: 5,142,371원)</p>
    <p class="sum-meta" style="color:#2563eb;">▼ 134,412원 (-2.6%)</p>
  </div>

  <div class="card">
    <div class="chart-row">
      <div class="chart-box">
        <p>전월 시간/수당 비율</p>
        <canvas id="donutPrev"></canvas>
      </div>
      <div class="chart-box">
        <p>당월 시간/수당 비율</p>
        <canvas id="donutNow"></canvas>
      </div>
    </div>
  </div>

  <div class="card">
    <h3 style="margin-top:0;">전월 대비 비교 차트</h3>
    <div class="chart-row">
      <div class="chart-box bar">
        <canvas id="barHours"></canvas>
        <p>시간 비교(전월 vs 당월)</p>
      </div>
    </div>
    <div class="chart-row">
      <div class="chart-box bar">
        <canvas id="barPays"></canvas>
        <p>수당 비교(총·시간외·휴일)</p>
      </div>
    </div>
  </div>
</section>
</main>

<div id="toast" class="toast"></div>

<script>
Chart.register(ChartDataLabels);
const donutPrev=document.getElementById('donutPrev');
const donutNow=document.getElementById('donutNow');
const barHours=document.getElementById('barHours');
const barPays=document.getElementById('barPays');
function drawDoughnut2(ctx,labels,data,colors){
  if(ctx._chart) ctx._chart.destroy();
  ctx._chart=new Chart(ctx,{
    type:'doughnut',
    data:{labels,datasets:[{data,backgroundColor:colors,borderWidth:2}]},
    options:{
      maintainAspectRatio:false,aspectRatio:1.4,cutout:'62%',
      plugins:{
        legend:{position:'bottom',labels:{boxWidth:16}},
        datalabels:{
          color:'#fff',
          font:{weight:'700',size:15},
          formatter:(v)=>v>0?`${v}%`:''
        }
      }
    },
    plugins:[ChartDataLabels]
  });
}
function drawGroupedBars(ctx,labels,prev,now,isMoney){
  if(ctx._chart) ctx._chart.destroy();
  ctx._chart=new Chart(ctx,{
    type:'bar',
    data:{
      labels,
      datasets:[
        {label:'전월',data:prev,backgroundColor:'#60a5fa',maxBarThickness:40},
        {label:'당월',data:now,backgroundColor:'#fca5a5',maxBarThickness:40}
      ]
    },
    options:{
      maintainAspectRatio:false,aspectRatio:1.8,
      plugins:{
        legend:{position:'bottom'},
        datalabels:{
          anchor:'end',align:'end',offset:4,
          color:'#111',backgroundColor:'rgba(255,255,255,.7)',
          borderRadius:4,padding:4,
          formatter:(v)=>isMoney?Number(v).toLocaleString():v
        }
      },
      scales:{
        y:{beginAtZero:true,grace:'10%',ticks:{callback:(v)=>isMoney?Number(v).toLocaleString():v}}
      }
    },
    plugins:[ChartDataLabels]
  });
}

// --- 샘플 데이터 (시뮬레이션 후 자동 교체될 부분) ---
const prevOverH=9, prevHolH=41;
const nowOverH=18, nowHolH=82;
drawDoughnut2(donutPrev,['연장시간','휴일시간'],[prevOverH,prevHolH],['#f5bcbc','#bcd7ff']);
drawDoughnut2(donutNow,['연장시간','휴일시간'],[nowOverH,nowHolH],['#ef4444','#2563eb']);
drawGroupedBars(barHours,['적용시간(h)','연장시간(h)','휴일시간(h)'],[214,40,174],[222,40,182],false);
drawGroupedBars(barPays,['총수당(원)','시간외수당(원)','휴일수당(원)'],[5142371,868727,3994606],[5007959,868727,4139232],true);
</script>
</body>
</html>
